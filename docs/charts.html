<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANALYTICS | Stock Predictor</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .terminal-container {
            max-width: 1400px;
            margin: 0 auto;
            border: 2px solid #00ff00;
            background: #000000;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }

        .terminal-header {
            background: #00ff00;
            color: #000;
            padding: 10px 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terminal-nav {
            background: #111;
            border-bottom: 1px solid #00ff00;
            padding: 15px 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-link {
            color: #00ff00;
            text-decoration: none;
            position: relative;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 0.9em;
            white-space: nowrap;
            padding: 5px 8px;
            border-radius: 3px;
        }

        .nav-link:hover {
            color: #ffffff;
            text-shadow: 0 0 15px #00ff00;
            background: #003300;
        }

        .nav-link.active::before {
            content: '[';
            position: absolute;
            left: -10px;
        }

        .nav-link.active::after {
            content: ']';
            position: absolute;
            right: -10px;
        }

        .terminal-body {
            padding: 30px;
        }

        .section-title {
            color: #00ff00;
            font-size: 1.5em;
            margin-bottom: 20px;
            border-bottom: 1px solid #00ff00;
            padding-bottom: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: #111;
            border: 1px solid #00ff00;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .metric-card:hover {
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
            transform: translateY(-2px);
        }

        .metric-label {
            color: #ffff00;
            font-size: 0.9em;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-value.positive {
            color: #00ff00;
        }

        .metric-value.negative {
            color: #ff4444;
        }

        .metric-value.neutral {
            color: #ffff00;
        }

        .metric-change {
            font-size: 0.8em;
            color: #888;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .analytics-panel {
            background: #111;
            border: 1px solid #00ff00;
            padding: 20px;
        }

        .panel-title {
            color: #ffff00;
            font-size: 1.1em;
            margin-bottom: 15px;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
        }

        .strategy-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #222;
        }

        .strategy-name {
            color: #00ff00;
            font-weight: bold;
        }

        .strategy-metric {
            color: #ffff00;
        }

        .prediction-row {
            display: grid;
            grid-template-columns: 1fr 80px 80px 100px;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #222;
            font-size: 0.9em;
        }

        .prediction-row:hover {
            background: rgba(0, 255, 0, 0.1);
        }

        .position-long {
            color: #00ff00;
            font-weight: bold;
        }

        .position-short {
            color: #ff4444;
            font-weight: bold;
        }

        .position-hold {
            color: #888;
        }

        .confidence-bar {
            height: 20px;
            background: #222;
            border: 1px solid #444;
            position: relative;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(to right, #ff4444, #ffff00, #00ff00);
            transition: width 0.3s;
        }

        .confidence-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8em;
            color: #000;
            font-weight: bold;
        }

        .market-overview {
            background: #111;
            border: 1px solid #00ff00;
            padding: 20px;
            margin-bottom: 30px;
        }

        .market-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .market-stat {
            text-align: center;
            padding: 10px;
            background: #222;
            border: 1px solid #333;
        }

        .stat-label {
            color: #888;
            font-size: 0.8em;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #00ff00;
            font-weight: bold;
            font-size: 1.2em;
        }

        .footer {
            text-align: center;
            padding: 20px;
            border-top: 1px solid #00ff00;
            color: #008800;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .prediction-row {
                grid-template-columns: 1fr 60px 60px 80px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="terminal-container">
        <div class="terminal-header">
            <div class="terminal-title">ANALYTICS_MODULE_v1.0</div>
            <div class="terminal-time" id="currentTime"></div>
        </div>

        <div class="terminal-nav">
            <a href="../index.html" class="nav-link">HOME</a>
            <a href="../predictions.html" class="nav-link">PREDICTIONS</a>
            <a href="charts.html" class="nav-link active">ANALYTICS</a>
            <a href="strategies.html" class="nav-link">STRATEGIES</a>
            <a href="performance.html" class="nav-link">PERFORMANCE</a>
            <a href="entry-tracker.html" class="nav-link">ENTRY_TRACKER</a>
            <a href="positions.html" class="nav-link">LIVE_POSITIONS</a>
            <a href="trade-history.html" class="nav-link">TRADE_HISTORY</a>
            <a href="monthly-performance.html" class="nav-link">MONTHLY</a>
            <a href="../historic.html" class="nav-link">HISTORIC</a>
            <a href="about.html" class="nav-link">ABOUT</a>
        </div>

        <div class="terminal-body">
            <h1 class="section-title">REAL-TIME ANALYTICS DASHBOARD</h1>

            <!-- Key Metrics -->
            <div class="metrics-grid" id="metricsGrid">
                <div class="metric-card">
                    <div class="metric-label">Active Signals</div>
                    <div class="metric-value positive" id="activeSignals">--</div>
                    <div class="metric-change" id="signalsChange">Loading...</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Avg Confidence</div>
                    <div class="metric-value neutral" id="avgConfidence">--</div>
                    <div class="metric-change" id="confidenceChange">Loading...</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Long Positions</div>
                    <div class="metric-value positive" id="longPositions">--</div>
                    <div class="metric-change" id="longChange">Loading...</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Short Positions</div>
                    <div class="metric-value negative" id="shortPositions">--</div>
                    <div class="metric-change" id="shortChange">Loading...</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Diversification</div>
                    <div class="metric-value neutral" id="diversification">--</div>
                    <div class="metric-change" id="diversificationChange">Loading...</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Market Sentiment</div>
                    <div class="metric-value" id="marketSentiment">--</div>
                    <div class="metric-change" id="sentimentChange">Loading...</div>
                </div>
            </div>

            <!-- Market Overview -->
            <div class="market-overview">
                <h2 class="panel-title">📊 CURRENT MARKET OVERVIEW</h2>
                <div class="market-stats">
                    <div class="market-stat">
                        <div class="stat-label">Stocks Tracked</div>
                        <div class="stat-value" id="stocksTracked">10</div>
                    </div>
                    <div class="market-stat">
                        <div class="stat-label">Strategies Active</div>
                        <div class="stat-value" id="strategiesActive">10</div>
                    </div>
                    <div class="market-stat">
                        <div class="stat-label">Total Predictions</div>
                        <div class="stat-value" id="totalPredictions">--</div>
                    </div>
                    <div class="market-stat">
                        <div class="stat-label">Last Update</div>
                        <div class="stat-value" id="lastUpdate">--</div>
                    </div>
                </div>
            </div>

            <!-- Analytics Panels -->
            <div class="analytics-grid">
                <!-- Strategy Performance -->
                <div class="analytics-panel">
                    <h3 class="panel-title">🎯 STRATEGY CONFIDENCE LEVELS</h3>
                    <div id="strategyConfidence">
                        <div class="loading">Loading strategy data...</div>
                    </div>
                </div>

                <!-- Current Predictions -->
                <div class="analytics-panel">
                    <h3 class="panel-title">📈 TODAY'S PREDICTIONS</h3>
                    <div id="currentPredictions">
                        <div class="loading">Loading predictions...</div>
                    </div>
                </div>

                <!-- Stock Distribution -->
                <div class="analytics-panel">
                    <h3 class="panel-title">📊 STOCK DISTRIBUTION</h3>
                    <div id="stockDistribution">
                        <div class="loading">Analyzing stock allocation...</div>
                    </div>
                </div>

                <!-- Position Analysis -->
                <div class="analytics-panel">
                    <h3 class="panel-title">⚖️ POSITION ANALYSIS</h3>
                    <div id="positionAnalysis">
                        <div class="loading">Calculating position metrics...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            REAL-TIME ANALYTICS | Data updated every 15 minutes | Last refresh: <span id="refreshTime">--</span>
        </div>
    </div>

    <script>
        // Global variables
        let predictionsData = null;
        let currentMetrics = {};

        // Update current time
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString();
        }
        updateTime();
        setInterval(updateTime, 1000);

        // Load and analyze real data
        async function loadAnalyticsData() {
            try {
                // Load predictions data
                const response = await fetch('../predictions_data.json');
                predictionsData = await response.json();

                analyzeData();
                updateDashboard();
                document.getElementById('refreshTime').textContent = new Date().toLocaleTimeString();
            } catch (error) {
                console.error('Error loading data:', error);
                showErrorState();
            }
        }

        function analyzeData() {
            if (!predictionsData || !predictionsData.predictions || !predictionsData.predictions[0]) {
                return;
            }

            const latestPredictions = predictionsData.predictions[0].predictions;
            const strategies = Object.keys(latestPredictions);

            // Calculate metrics
            const longCount = strategies.filter(s => latestPredictions[s].position === 'LONG').length;
            const shortCount = strategies.filter(s => latestPredictions[s].position === 'SHORT').length;
            const holdCount = strategies.filter(s => latestPredictions[s].position === 'HOLD').length;

            const confidences = strategies
                .filter(s => latestPredictions[s].position !== 'HOLD')
                .map(s => latestPredictions[s].confidence || 0);

            const avgConfidence = confidences.length > 0 ?
                confidences.reduce((a, b) => a + b, 0) / confidences.length : 0;

            // Count unique stocks
            const uniqueStocks = new Set(
                strategies
                    .filter(s => latestPredictions[s].position !== 'HOLD')
                    .map(s => latestPredictions[s].stock)
            );

            // Calculate market sentiment
            const bullishSignals = longCount;
            const bearishSignals = shortCount;
            let sentiment = 'NEUTRAL';
            let sentimentClass = 'neutral';

            if (bullishSignals > bearishSignals + 2) {
                sentiment = 'BULLISH';
                sentimentClass = 'positive';
            } else if (bearishSignals > bullishSignals + 2) {
                sentiment = 'BEARISH';
                sentimentClass = 'negative';
            }

            currentMetrics = {
                activeSignals: longCount + shortCount,
                avgConfidence: avgConfidence,
                longCount: longCount,
                shortCount: shortCount,
                holdCount: holdCount,
                uniqueStocks: uniqueStocks.size,
                sentiment: sentiment,
                sentimentClass: sentimentClass,
                totalPredictions: strategies.length,
                diversification: uniqueStocks.size,
                lastUpdate: predictionsData.predictions[0].date
            };
        }

        function updateDashboard() {
            // Update key metrics
            document.getElementById('activeSignals').textContent = currentMetrics.activeSignals;
            document.getElementById('avgConfidence').textContent = (currentMetrics.avgConfidence * 100).toFixed(1) + '%';
            document.getElementById('longPositions').textContent = currentMetrics.longCount;
            document.getElementById('shortPositions').textContent = currentMetrics.shortCount;
            document.getElementById('diversification').textContent = currentMetrics.uniqueStocks + '/10';

            const sentimentEl = document.getElementById('marketSentiment');
            sentimentEl.textContent = currentMetrics.sentiment;
            sentimentEl.className = `metric-value ${currentMetrics.sentimentClass}`;

            document.getElementById('totalPredictions').textContent = currentMetrics.totalPredictions;
            document.getElementById('lastUpdate').textContent = currentMetrics.lastUpdate;

            // Update strategy confidence panel
            updateStrategyConfidence();

            // Update current predictions
            updateCurrentPredictions();

            // Update stock distribution
            updateStockDistribution();

            // Update position analysis
            updatePositionAnalysis();
        }

        function updateStrategyConfidence() {
            const latestPredictions = predictionsData.predictions[0].predictions;
            const strategies = Object.keys(latestPredictions);

            let html = '';
            strategies.forEach(strategy => {
                const pred = latestPredictions[strategy];
                const confidence = (pred.confidence || 0) * 100;
                const position = pred.position;

                html += `
                    <div class="strategy-item">
                        <div class="strategy-name">${strategy.replace('_', ' ').toUpperCase()}</div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidence}%"></div>
                            <div class="confidence-text">${confidence.toFixed(0)}%</div>
                        </div>
                    </div>
                `;
            });

            document.getElementById('strategyConfidence').innerHTML = html;
        }

        function updateCurrentPredictions() {
            const latestPredictions = predictionsData.predictions[0].predictions;
            const strategies = Object.keys(latestPredictions)
                .filter(s => latestPredictions[s].position !== 'HOLD')
                .sort((a, b) => (latestPredictions[b].confidence || 0) - (latestPredictions[a].confidence || 0));

            let html = `
                <div class="prediction-row" style="font-weight: bold; border-bottom: 2px solid #00ff00;">
                    <div>STOCK</div>
                    <div>POS</div>
                    <div>CONF</div>
                    <div>PROJECTED</div>
                </div>
            `;

            strategies.forEach(strategy => {
                const pred = latestPredictions[strategy];
                const positionClass = pred.position === 'LONG' ? 'position-long' :
                                    pred.position === 'SHORT' ? 'position-short' : 'position-hold';

                html += `
                    <div class="prediction-row">
                        <div class="strategy-name">${pred.stock}</div>
                        <div class="${positionClass}">${pred.position}</div>
                        <div>${((pred.confidence || 0) * 100).toFixed(0)}%</div>
                        <div class="${positionClass}">${pred.projected || 'N/A'}</div>
                    </div>
                `;
            });

            document.getElementById('currentPredictions').innerHTML = html;
        }

        function updateStockDistribution() {
            const latestPredictions = predictionsData.predictions[0].predictions;
            const stockCounts = {};

            Object.values(latestPredictions)
                .filter(p => p.position !== 'HOLD')
                .forEach(pred => {
                    stockCounts[pred.stock] = (stockCounts[pred.stock] || 0) + 1;
                });

            const sortedStocks = Object.entries(stockCounts)
                .sort((a, b) => b[1] - a[1]);

            let html = '';
            sortedStocks.forEach(([stock, count]) => {
                const percentage = (count / Object.keys(latestPredictions).length * 100).toFixed(1);
                html += `
                    <div class="strategy-item">
                        <div class="strategy-name">${stock}</div>
                        <div class="strategy-metric">${count} signals (${percentage}%)</div>
                    </div>
                `;
            });

            if (html === '') {
                html = '<div class="strategy-item"><div class="strategy-name">No active positions</div></div>';
            }

            document.getElementById('stockDistribution').innerHTML = html;
        }

        function updatePositionAnalysis() {
            const bull = currentMetrics.longCount;
            const bear = currentMetrics.shortCount;
            const neutral = currentMetrics.holdCount;
            const total = bull + bear + neutral;

            const bullPercent = total > 0 ? (bull / total * 100).toFixed(1) : 0;
            const bearPercent = total > 0 ? (bear / total * 100).toFixed(1) : 0;
            const neutralPercent = total > 0 ? (neutral / total * 100).toFixed(1) : 0;

            const html = `
                <div class="strategy-item">
                    <div class="strategy-name">BULLISH SIGNALS</div>
                    <div class="strategy-metric position-long">${bull} (${bullPercent}%)</div>
                </div>
                <div class="strategy-item">
                    <div class="strategy-name">BEARISH SIGNALS</div>
                    <div class="strategy-metric position-short">${bear} (${bearPercent}%)</div>
                </div>
                <div class="strategy-item">
                    <div class="strategy-name">NEUTRAL/HOLD</div>
                    <div class="strategy-metric position-hold">${neutral} (${neutralPercent}%)</div>
                </div>
                <div class="strategy-item">
                    <div class="strategy-name">SIGNAL STRENGTH</div>
                    <div class="strategy-metric">${currentMetrics.avgConfidence > 0.7 ? 'STRONG' : currentMetrics.avgConfidence > 0.5 ? 'MODERATE' : 'WEAK'}</div>
                </div>
            `;

            document.getElementById('positionAnalysis').innerHTML = html;
        }

        function showErrorState() {
            document.getElementById('metricsGrid').innerHTML = `
                <div class="metric-card">
                    <div class="metric-label">Status</div>
                    <div class="metric-value negative">ERROR</div>
                    <div class="metric-change">Unable to load data</div>
                </div>
            `;
        }

        // Initialize dashboard
        loadAnalyticsData();

        // Auto-refresh every 5 minutes
        setInterval(loadAnalyticsData, 300000);
    </script>
</body>
</html>